---
title: "1104sec7"
output: word_document
---

```{r}
library(ISLR)
attach(Wage)
head(Wage, 3)
#7.8.1. Polynomial regression and Step functions
Wage$age   #원래 이렇게 써야하는데 위에서 attachㅎ

mod1 = lm(wage ~ poly(age, 4), data=Wage)
summary(mod1)  #첫번째 계수가 441이라는게 아님
mod2 = lm(wage ~ age + I(age^2)+ I(age^3)+ I(age^4), data=Wage)
summary(mod2)#위와 같은 결과. 우린 밑에 식처럼한다. 통계에서는 위의 식을 더 많이 쓴다. 

pred1 = predict(mod1, newdata=Wage, type="response")
pred2 = predict(mod2, newdata=Wage, type="response")

mod10 = lm(wage ~ poly(age, 10), data=Wage)
pred10 = predict(mod10, newdata=Wage, type="response")

plot(age, wage)
points(age, pred10, col=4)
#점이 데이터이고 10차원식을 맞춘식이 파란저

mod1 = lm(wage ~ poly(age, 4), data=Wage)
mod20 =lm(wage ~ education + poly(age,3), data=Wage)   #edu도 중요
pred20 = predict(mod20, newdata=Wage, type="response")
#Q: mod1 과 mod20 누가 더 좋나요? Test MSE 비교하면된다.(CV MSE)

#Train MSE를 비교해 볼께요 (좋은 방법은 아니죠.)
MSE1 = mean((wage-pred1)^2)
MSE20 = mean((wage-pred20)^2)
MSE1
MSE20 #train으로 봤을 때는 mod20이 더 좋으나 test MSE를 봐야하므로 좋은 방법은 아니다. 

########11/9수업 소리 날라가서 하나도 모름###########

#Step Function 방법:

table(cut(age,4))
cut(age,4)
mod_step = lm(wage ~ cut(age,4), data=Wage)
summary(mod_step)

head(Wage)
# age= 18, yhat= 94.158
pred_step = predict(mod_step, newdata=Wage, type="response")
pred_step[1]

#Sec 7.8.2 Splines
#install.packages("splines")
library(splines)
hist(age)
mod_bs = lm(wage ~ bs(age, knots = c(25, 40, 60)), data=Wage) #default df=3
summary(mod_bs)

pred_bs = predict(mod_bs, newdata=Wage, type="response")
plot(age, wage)
points(age, pred_bs, col=2) #95% confidence interval 방법은 책을 참조하세요.

mod_ns = lm(wage ~ ns(age, knots = c(25, 40, 60)), data=Wage) #default df=3
pred_ns = predict(mod_ns, newdata=Wage, type="response")
points(age, pred_ns, col=4) #95% confidence interval 방법은 책을 참조하세요.
head(Wage)

mod_ns10 = lm(wage ~ ns(age, knots = c(25, 40, 60), df=20) , data=Wage) #default df=3
pred_ns10 = predict(mod_ns10, newdata=Wage, type="response")
points(age, pred_ns10, col=3) #95% confidence interval 방법은 책을 참조하세요.


#Smoothing spline

mod_ss = smooth.spline(age, wage, df=4)
summary(mod_ss)
pred_ss = predict(mod_ss, newdata=Wage, type="response")
pred_ss
points(pred_ss$x, pred_ss$y, col=3) #95% confidence interval 방법은 책을 참조하세요.

#GAMs
library(gam)
gam.m3 = gam(wage ~ s(year, 10) + s(age, 10) + education, data=Wage)
par(mfrow=c(1,3))
plot(gam.m3, se=TRUE, col=2)
summary(gam.m3)

pred_m3 = predict(gam.m3, newdata=Wage, type="response")
MSE_m3 = mean( (wage - pred_m3)^2 )
MSE_m3




```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
